<html xmlns="http://www.w3.org/1999/html">
  <head>
    <title>WNC Supplies Database</title>

    <script type="text/javascript">
      function handleSelection(elementSelected)
      {
        var selectionBox = document.getElementById(elementSelected + "-select");
        var selection = selectionBox.value;

        if(selection === "") {
          return;
        }
        addSelection(elementSelected, selection);
      }

      function addSelection(elementSelected, value) {
        if(value === "") {
          return;
        }
        var currentSelections = fetchSelections(elementSelected);
        if(currentSelections.includes(value)) {
          return;
        }

        var selectionDiv = document.getElementById(elementSelected + "-selections");
        selectionDiv.innerHTML +=
                `<div class='box horizontal' onclick="removeDiv(this)">
                    <div style="margin-right: 5px"><button type="button">X</button></div>
                    <div class="selected-value">${value}</div>\
                </div>`
      }

      function removeDiv(div) {
        div.parentNode.removeChild(div);
      }

      function fetchSelections(selectionElement) {
        var selectionsDiv = document.getElementById(selectionElement + "-selections");
        var selections = [...selectionsDiv.querySelectorAll(".selected-value")].map(v => v.innerHTML);
        // var selections = document.querySelectorAll("#" + selectionElement + "-selections #selected-value");
        //.map(v => v.innerHTML);
        //.join(',');
        return selections;
      }

      function selectAll(selectionElement) {
        let selectElement = document.querySelector('[id=' + selectionElement + '-select]');
        [...selectElement.options].map(o => o.value).forEach(v => addSelection(selectionElement, v));


      }

      function clearSelections(selectionElement) {
        document.getElementById(selectionElement + "-selections").innerHTML = "";
      }


    </script>

    <style>
      .vertical {
        display: flex;
        flex-direction: column;
      }

      .horizontal {
        display: flex;
        flex-direction: row;
      }

      .box {
        width: 100px;
        height: 25px;
        border: 1px solid black;
        padding: 3px;
        margin: 3px;
      }

    </style>
  </head>
  <body>
    <form>
      <table>
        <tr>
          <td>
            <div class="vertical">
              <label for="site-select">Donation Site:</label>
              <select id="site-select" onchange="handleSelection('site')">
                <option value=""></option>
                <option value="site1">site1</option>
                <option value="site2">site2</option>
              </select>
            </div>
          </td>
          <td>
            <div class="vertical">
                <label for="county-select">County:</label>
                <select id="county-select" onchange="handleSelection('county')">
                  <option value=""></option>
                  <option value="Ashe">Ashe</option>
                  <option value="Buncombe">Buncombe</option>
                  <option value="Watauga">Watauga</option>
                </select>
            </div>
          </td>
          <td>
            <div class="vertical">
              <label for="item-select">Items:</label>
              <select id="item-select" onchange="handleSelection('item')">
                <option value=""></option>
                <option value="shampoo">Shampoo</option>
                <option value="gloves">Gloves</option>
              </select>
            </div>
          </td>
        </tr>
        <tr>
          <td>
            <div class="vertical">
              <button type="button" onclick="selectAll('site')">Select all</button>
              <button type="button" onclick="clearSelections('site')">Clear all</button>
            </div>
          </td>
          <td>
            <div class="vertical">
              <button type="button" onclick="selectAll('county')">Select all</button>
              <button type="button" onclick="clearSelections('county')">Clear all</button>
            </div>
          </td>
          <td>
            <div class="vertical">
              <button type="button" onclick="selectAll('item')">Select all</button>
              <button type="button" onclick="clearSelections('item')">Clear all</button>
            </div>
          </td>
        </tr>
        <tr>
          <td>
            <div id="site-selections">
            </div>
          </td>
          <td>
            <div id="county-selections">
            </div>
          </td>
          <td>
            <div id="item-selections">
            </div>
          </td>
        </tr>
      </table>
      <button type="button" onclick="handleClick()">Update</button>
    </form>
    <table id="results-table">
      <thead>
        <tr>
          <th>Site</th>
          <th>County</th>
          <th>Items</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Example</td><td>Ashe</td><td>Soap<br>Shampoo</td>
        </tr>
      </tbody>
    </table>
  </body>
</html>
